var InstantClick=function(document,location){function removeHash(url){var index=url.indexOf("#");return index<0?url:url.substr(0,index)}function getLinkTarget(target){for(;target&&"A"!=target.nodeName;)target=target.parentNode;return target}function isBlacklisted(elem){do{if(!elem.hasAttribute)break;if(elem.hasAttribute("data-instant"))return!1;if(elem.hasAttribute("data-no-instant"))return!0}while(elem=elem.parentNode);return!1}function isWhitelisted(elem){do{if(!elem.hasAttribute)break;if(elem.hasAttribute("data-no-instant"))return!1;if(elem.hasAttribute("data-instant"))return!0}while(elem=elem.parentNode);return!1}function isPreloadable(a){var domain=location.protocol+"//"+location.host;return!(a.target||a.hasAttribute("download")||0!=a.href.indexOf(domain+"/")||a.href.indexOf("#")>-1&&removeHash(a.href)==$currentLocationWithoutHash||($useWhitelist?!isWhitelisted(a):isBlacklisted(a)))}function triggerPageEvent(eventType,arg1,arg2,arg3){for(var returnValue=!1,i=0;i<$eventsCallbacks[eventType].length;i++)if("receive"==eventType){var altered=$eventsCallbacks[eventType][i](arg1,arg2,arg3);altered&&("body"in altered&&(arg2=altered.body),"title"in altered&&(arg3=altered.title),returnValue=altered)}else $eventsCallbacks[eventType][i](arg1,arg2,arg3);return returnValue}function changePage(title,body,newUrl,scrollY){if(document.documentElement.replaceChild(body,document.body),newUrl){history.pushState(null,null,newUrl);var hashIndex=newUrl.indexOf("#"),hashElem=hashIndex>-1&&document.getElementById(newUrl.substr(hashIndex+1)),offset=0;if(hashElem)for(;hashElem.offsetParent;)offset+=hashElem.offsetTop,hashElem=hashElem.offsetParent;scrollTo(0,offset),$currentLocationWithoutHash=removeHash(newUrl)}else scrollTo(0,scrollY);$isChromeForIOS&&document.title==title?document.title=title+String.fromCharCode(160):document.title=title,instantanize(),bar.done(),triggerPageEvent("change",!1);var userscriptEvent=document.createEvent("HTMLEvents");userscriptEvent.initEvent("instantclick:newpage",!0,!0),dispatchEvent(userscriptEvent)}function setPreloadingAsHalted(){$isPreloading=!1,$isWaitingForCompletion=!1}function removeNoscriptTags(html){return html.replace(/<noscript[\s\S]+<\/noscript>/gi,"")}function mousedown(e){if(!($lastTouchTimestamp>+new Date-500)){var a=getLinkTarget(e.target);a&&isPreloadable(a)&&preload(a.href)}}function mouseover(e){if(!($lastTouchTimestamp>+new Date-500)){var a=getLinkTarget(e.target);a&&isPreloadable(a)&&(a.addEventListener("mouseout",mouseout),$delayBeforePreload?($urlToPreload=a.href,$preloadTimer=setTimeout(preload,$delayBeforePreload)):preload(a.href))}}function touchstart(e){$lastTouchTimestamp=+new Date;var a=getLinkTarget(e.target);a&&isPreloadable(a)&&($preloadOnMousedown?a.removeEventListener("mousedown",mousedown):a.removeEventListener("mouseover",mouseover),preload(a.href))}function click(e){var a=getLinkTarget(e.target);a&&isPreloadable(a)&&(e.which>1||e.metaKey||e.ctrlKey||(e.preventDefault(),display(a.href)))}function mouseout(){return $preloadTimer?(clearTimeout($preloadTimer),void($preloadTimer=!1)):void($isPreloading&&!$isWaitingForCompletion&&($xhr.abort(),setPreloadingAsHalted()))}function readystatechange(){if(!($xhr.readyState<4)&&0!=$xhr.status){if($timing.ready=+new Date-$timing.start,$xhr.getResponseHeader("Content-Type").match(/\/(x|ht|xht)ml/)){var doc=document.implementation.createHTMLDocument("");doc.documentElement.innerHTML=removeNoscriptTags($xhr.responseText),$title=doc.title,$body=doc.body;var alteredOnReceive=triggerPageEvent("receive",$url,$body,$title);alteredOnReceive&&("body"in alteredOnReceive&&($body=alteredOnReceive.body),"title"in alteredOnReceive&&($title=alteredOnReceive.title));var urlWithoutHash=removeHash($url);$history[urlWithoutHash]={body:$body,title:$title,scrollY:urlWithoutHash in $history?$history[urlWithoutHash].scrollY:0};for(var elem,data,elems=doc.head.children,found=0,i=elems.length-1;i>=0;i--)if(elem=elems[i],elem.hasAttribute("data-instant-track")){data=elem.getAttribute("href")||elem.getAttribute("src")||elem.innerHTML;for(var j=$trackedAssets.length-1;j>=0;j--)$trackedAssets[j]==data&&found++}found!=$trackedAssets.length&&($mustRedirect=!0)}else $mustRedirect=!0;$isWaitingForCompletion&&($isWaitingForCompletion=!1,display($url))}}function instantanize(isInitializing){if(document.body.addEventListener("touchstart",touchstart,!0),$preloadOnMousedown?document.body.addEventListener("mousedown",mousedown,!0):document.body.addEventListener("mouseover",mouseover,!0),document.body.addEventListener("click",click,!0),!isInitializing){var script,copy,parentNode,nextSibling,scripts=document.body.getElementsByTagName("script");for(i=0,j=scripts.length;i<j;i++)script=scripts[i],script.hasAttribute("data-no-instant")||(copy=document.createElement("script"),script.src&&(copy.src=script.src),script.innerHTML&&(copy.innerHTML=script.innerHTML),parentNode=script.parentNode,nextSibling=script.nextSibling,parentNode.removeChild(script),parentNode.insertBefore(copy,nextSibling))}}function preload(url){!$preloadOnMousedown&&"display"in $timing&&+new Date-($timing.start+$timing.display)<100||($preloadTimer&&(clearTimeout($preloadTimer),$preloadTimer=!1),url||(url=$urlToPreload),$isPreloading&&(url==$url||$isWaitingForCompletion)||($isPreloading=!0,$isWaitingForCompletion=!1,$url=url,$body=!1,$mustRedirect=!1,$timing={start:+new Date},triggerPageEvent("fetch"),$xhr.open("GET",url),$xhr.send()))}function display(url){return"display"in $timing||($timing.display=+new Date-$timing.start),$preloadTimer||!$isPreloading?$preloadTimer&&$url&&$url!=url?void(location.href=url):(preload(url),bar.start(0,!0),triggerPageEvent("wait"),void($isWaitingForCompletion=!0)):$isWaitingForCompletion?void(location.href=url):$mustRedirect?void(location.href=$url):$body?($history[$currentLocationWithoutHash].scrollY=pageYOffset,setPreloadingAsHalted(),void changePage($title,$body,$url)):(bar.start(0,!0),triggerPageEvent("wait"),void($isWaitingForCompletion=!0))}function init(){if(!$currentLocationWithoutHash){if(!supported)return void triggerPageEvent("change",!0);for(var i=arguments.length-1;i>=0;i--){var arg=arguments[i];arg===!0?$useWhitelist=!0:"mousedown"==arg?$preloadOnMousedown=!0:"number"==typeof arg&&($delayBeforePreload=arg)}$currentLocationWithoutHash=removeHash(location.href),$history[$currentLocationWithoutHash]={body:document.body,title:document.title,scrollY:pageYOffset};for(var elem,data,elems=document.head.children,i=elems.length-1;i>=0;i--)elem=elems[i],elem.hasAttribute("data-instant-track")&&(data=elem.getAttribute("href")||elem.getAttribute("src")||elem.innerHTML,$trackedAssets.push(data));$xhr=new XMLHttpRequest,$xhr.addEventListener("readystatechange",readystatechange),instantanize(!0),bar.init(),triggerPageEvent("change",!0),addEventListener("popstate",function(){var loc=removeHash(location.href);if(loc!=$currentLocationWithoutHash){if(!(loc in $history))return void(location.href=location.href);$history[$currentLocationWithoutHash].scrollY=pageYOffset,$currentLocationWithoutHash=loc,changePage($history[loc].title,$history[loc].body,!1,$history[loc].scrollY)}})}}function on(eventType,callback){$eventsCallbacks[eventType].push(callback)}var $currentLocationWithoutHash,$urlToPreload,$preloadTimer,$lastTouchTimestamp,$xhr,$useWhitelist,$preloadOnMousedown,$delayBeforePreload,$ua=navigator.userAgent,$isChromeForIOS=$ua.indexOf(" CriOS/")>-1,$hasTouch="createTouch"in document,$history={},$url=!1,$title=!1,$mustRedirect=!1,$body=!1,$timing={},$isPreloading=!1,$isWaitingForCompletion=!1,$trackedAssets=[],$eventsCallbacks={fetch:[],receive:[],wait:[],change:[]},bar=function(){function init(){$barContainer=document.createElement("div"),$barContainer.id="instantclick",$barElement=document.createElement("div"),$barElement.id="instantclick-bar",$barElement.className="instantclick-bar",$barContainer.appendChild($barElement);var vendors=["Webkit","Moz","O"];if($barTransformProperty="transform",!($barTransformProperty in $barElement.style))for(var i=0;i<3;i++)vendors[i]+"Transform"in $barElement.style&&($barTransformProperty=vendors[i]+"Transform");var transitionProperty="transition";if(!(transitionProperty in $barElement.style))for(var i=0;i<3;i++)vendors[i]+"Transition"in $barElement.style&&(transitionProperty="-"+vendors[i].toLowerCase()+"-"+transitionProperty);var style=document.createElement("style");style.innerHTML="#instantclick{position:"+($hasTouch?"absolute":"fixed")+";top:0;left:0;width:100%;pointer-events:none;z-index:2147483647;"+transitionProperty+":opacity .25s .1s}.instantclick-bar{background:#29d;width:100%;margin-left:-100%;height:2px;"+transitionProperty+":all .25s}",document.head.appendChild(style),$hasTouch&&(updatePositionAndScale(),addEventListener("resize",updatePositionAndScale),addEventListener("scroll",updatePositionAndScale))}function start(at,jump){$barProgress=at,document.getElementById($barContainer.id)&&document.body.removeChild($barContainer),$barContainer.style.opacity="1",document.getElementById($barContainer.id)&&document.body.removeChild($barContainer),update(),jump&&setTimeout(jumpStart,0),clearTimeout($barTimer),$barTimer=setTimeout(inc,500)}function jumpStart(){$barProgress=10,update()}function inc(){$barProgress+=1+2*Math.random(),$barProgress>=98?$barProgress=98:$barTimer=setTimeout(inc,500),update()}function update(){$barElement.style[$barTransformProperty]="translate("+$barProgress+"%)",document.getElementById($barContainer.id)||document.body.appendChild($barContainer)}function done(){return document.getElementById($barContainer.id)?(clearTimeout($barTimer),$barProgress=100,update(),void($barContainer.style.opacity="0")):(start(100==$barProgress?0:$barProgress),void setTimeout(done,0))}function updatePositionAndScale(){$barContainer.style.left=pageXOffset+"px",$barContainer.style.width=innerWidth+"px",$barContainer.style.top=pageYOffset+"px";var landscape="orientation"in window&&90==Math.abs(orientation),scaleY=innerWidth/screen[landscape?"height":"width"]*2;$barContainer.style[$barTransformProperty]="scaleY("+scaleY+")"}var $barContainer,$barElement,$barTransformProperty,$barProgress,$barTimer;return{init:init,start:start,done:done}}(),supported="pushState"in history&&(!$ua.match("Android")||$ua.match("Chrome/"))&&"file:"!=location.protocol;return{supported:supported,init:init,on:on}}(document,location);